# Chunk 1: setup
# Clear and set working directory
rm(list = ls())
library(here)
require("dplyr")
require("tibble")
require("tidyr")
require("readr")
# Chunk 2
data <- read.csv(here("breseq/unified/count-diff.csv"), header = TRUE)
nut.treat <- c("N", "N", "N", "N", "P", "P", "P", "P")
phage.treat <- c("minus", "plus", "plus", "plus", "minus", "plus", "plus", "plus")
data <- data.frame(nut.treat, phage.treat, data[,c(3:5, 15, 16)])
colnames(data) <- c("nut.lim", "phage", "total", "base.sub", "s.indel", "mut.syn", "mut.non.syn")
# Chunk 3
mut <- data %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(base.sub))
mut.mat <- matrix(mut$base.sub, ncol = 2, byrow = F)
colnames(mut.mat) <- c("N","P")
rownames(mut.mat) <- c("minus", "plus")
mut.tab <- as.table(mut.mat)
mut.tab.margins <- addmargins(mut.tab)
mut.chi <- chisq.test(mut.tab)
# p-value = 0.33: non-synonymous (recheck)
# p-value = 2.993e-09: total unique
# Posthoc analysis
mut.z <- as.data.frame(mut.chi$stdres)
mut.x2 <- mut.z$Freq^2
mut.p <- pchisq(mut.x2, df = 1, lower.tail = FALSE)
mut.p.adj <- p.adjust(mut.p, method = "BH")
mut.post.hoc <- data.frame(mut.z, mut.x2, mut.p, mut.p.adj)
colnames(mut.post.hoc) <- c("phage", "nut.lim", "z", "chi2", "p", "p.adj")
# Non-synonymous
#  phage nut.lim         z     chi2         p     p.adj
#1 minus       N -1.224352 1.499038 0.2208194 0.2208194
#2  plus       N  1.224352 1.499038 0.2208194 0.2208194
#3 minus       P  1.224352 1.499038 0.2208194 0.2208194
#4  plus       P -1.224352 1.499038 0.2208194 0.2208194
# Base substitutions
#1 minus       N -6.015039 36.1807 1.79843e-09 1.79843e-09
#2  plus       N  6.015039 36.1807 1.79843e-09 1.79843e-09
#3 minus       P  6.015039 36.1807 1.79843e-09 1.79843e-09
#4  plus       P -6.015039 36.1807 1.79843e-09 1.79843e-09
# Chunk 4
# mutation data
mut.data <- read_csv(here("data/mutPositions_wPrevalence.csv"))
# data of chemostat treament
cstat.trt <- read_csv(here("data/cID_trt.csv"))
# join treatment and muation data
mut.data <- left_join(mut.data, cstat.trt, by="cID")
# Chunk 5
# choose filtering threshold of mutation prevalence (0-1)
prevalence.threshold <- 1
data2 <- mut.data%>%
filter(prevalence < prevalence.threshold) %>%
group_by(nut.lim, phage , cID, mutation_category) %>%
summarise(n = n())%>%
pivot_wider(values_from = n ,names_from = mutation_category, values_fill = 0)
data3 <- mut.data%>%
filter(prevalence < prevalence.threshold) %>%
group_by(nut.lim, phage , cID, mutation_type) %>%
summarise(n = n())%>%
pivot_wider(values_from = n ,names_from = mutation_type, values_fill = 0)
# columns in original data df
# c("nut.lim", "phage", "total", "base.sub", "s.indel", "mut.syn", "mut.non.syn")
# columns now in data2 df
# c("nut.lim", "phage", "cID", "small_indel", "snp_noncoding", "snp_nonsynonymous", "snp_synonymous", "snp_intergenic", "snp_nonsense" )
mut <- data3 %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(SUB))
mut <- data %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(base.sub))
mut.mat <- matrix(mut$base.sub, ncol = 2, byrow = F)
colnames(mut.mat) <- c("N","P")
rownames(mut.mat) <- c("minus", "plus")
mut.tab <- as.table(mut.mat)
mut.tab.margins <- addmargins(mut.tab)
mut.chi <- chisq.test(mut.tab)
# p-value = 0.33: non-synonymous (recheck)
# p-value = 2.993e-09: total unique
# Posthoc analysis
mut.z <- as.data.frame(mut.chi$stdres)
mut.x2 <- mut.z$Freq^2
mut.p <- pchisq(mut.x2, df = 1, lower.tail = FALSE)
mut.p.adj <- p.adjust(mut.p, method = "BH")
mut.post.hoc <- data.frame(mut.z, mut.x2, mut.p, mut.p.adj)
colnames(mut.post.hoc) <- c("phage", "nut.lim", "z", "chi2", "p", "p.adj")
# Non-synonymous
#  phage nut.lim         z     chi2         p     p.adj
#1 minus       N -1.224352 1.499038 0.2208194 0.2208194
#2  plus       N  1.224352 1.499038 0.2208194 0.2208194
#3 minus       P  1.224352 1.499038 0.2208194 0.2208194
#4  plus       P -1.224352 1.499038 0.2208194 0.2208194
# Base substitutions
#1 minus       N -6.015039 36.1807 1.79843e-09 1.79843e-09
#2  plus       N  6.015039 36.1807 1.79843e-09 1.79843e-09
#3 minus       P  6.015039 36.1807 1.79843e-09 1.79843e-09
#4  plus       P -6.015039 36.1807 1.79843e-09 1.79843e-09
View(mut)
mut <- data3 %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(SUB))
mut <- data3 %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(SUB))
mut.mat <- pivot_wider(mut, names_from = nut.lim, values_from = base.sub)%>%
select(-phage)%>%
as.matrix()
# colnames(mut.mat) <- c("N","P")
rownames(mut.mat) <- c("minus", "plus")
mut.tab <- as.table(mut.mat)
mut.tab.margins <- addmargins(mut.tab)
mut.chi <- chisq.test(mut.tab)
# Posthoc analysis
mut.z <- as.data.frame(mut.chi$stdres)
mut.x2 <- mut.z$Freq^2
mut.p <- pchisq(mut.x2, df = 1, lower.tail = FALSE)
mut.p.adj <- p.adjust(mut.p, method = "BH")
mut.post.hoc <- data.frame(mut.z, mut.x2, mut.p, mut.p.adj)
colnames(mut.post.hoc) <- c("phage", "nut.lim", "z", "chi2", "p", "p.adj")
mut.post.hoc
mut.p
mut.z$Freq
mut.chi
View(data3)
mut <- data3 %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(SNP))
View(mut)
mut <- data3 %>%
group_by(nut.lim, phage) %>%
summarise(base.sub = sum(SNP)+sum(SUB))
View(mut)
View(data3)
View(data2)
mut.data%>%
group_by(mutation_type, mutation_category)%>%
summarise(n=n())
